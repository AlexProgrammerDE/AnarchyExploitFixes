plugins {
    id("aef.project-conventions")
    alias(libs.plugins.shadow)
    alias(libs.plugins.runpaper)
}

runPaper.folia.registerTask()

tasks {
    runServer {
        minecraftVersion(libs.versions.runpaperversion.get())
    }
}

dependencies {
    implementation(projects.common)
    implementation(projects.folia)

    compileOnly(libs.paper)

    implementation(libs.configmaster)
    implementation(libs.commandframework)
    implementation(libs.commandframework.annotations)
    compileOnly(libs.protocollib)
    implementation(libs.nbtapi)
    implementation(libs.paperlib)
    implementation(libs.bstats)
    implementation(libs.fastmath)
    implementation(libs.icu4j)
    implementation(libs.caffeine)
    implementation(libs.xseries)

    implementation(libs.adventure.platform)
    implementation(libs.adventure.text.minimessage)
}

tasks.jar {
    archiveFileName = "${rootProject.name}-${project.version}-unshaded.jar"
}

tasks.build.configure {
    dependsOn("shadowJar")
}

tasks.shadowJar {
    archiveFileName = "${rootProject.name}-${project.version}.jar"
    exclude(
        "LICENSE",
        "META-INF/maven/**",
        "META-INF/**/module-info.class",
        "META-INF/MANIFEST.MF",
        "META-INF/LICENSE",
        "META-INF/LICENSE.txt",
        "META-INF/NOTICE.txt",
        "com/cryptomorin/xseries/XBiome*",
        "com/cryptomorin/xseries/XEntity*",
        "com/cryptomorin/xseries/XPotion*",
        "com/cryptomorin/xseries/NMSExtras*",
        "com/cryptomorin/xseries/NoteBlockMusic*",
        "com/cryptomorin/xseries/SkullCacheListener*"
    )
    relocate("com.github.benmanes.caffeine", "me.moomoo.anarchyexploitfixes.libs.caffeine")
    relocate("io.papermc.lib", "me.moomoo.anarchyexploitfixes.libs.paperlib")
    relocate("de.tr7zw.changeme.nbtapi", "me.moomoo.anarchyexploitfixes.libs.nbtapi")
    relocate("org.bstats", "me.moomoo.anarchyexploitfixes.libs.bstats")
}
