import com.github.jengelman.gradle.plugins.shadow.tasks.ShadowJar

plugins {
    id("aef.project-conventions")
    id("com.github.johnrengelman.shadow")
    id("xyz.jpenilla.run-paper")
}

tasks {
    runServer {
        minecraftVersion("1.20.4")
    }
}

dependencies {
    compileOnly("com.destroystokyo.paper:paper-api:1.12.2-R0.1-SNAPSHOT")
    api("com.github.cryptomorin:XSeries:9.8.0") // XSeries for cross-version support
    api("com.github.ben-manes.caffeine:caffeine:2.9.3") // Fast caching // Use 2.x for Java8 compatibility
}

tasks.withType<ShadowJar> {
    archiveFileName = "${rootProject.name}-${project.name}-${project.version}.${archiveExtension.get()}"
    exclude(
        "LICENSE",
        "META-INF/maven/**",
        "META-INF/**/module-info.class",
        "META-INF/MANIFEST.MF",
        "META-INF/LICENSE",
        "META-INF/LICENSE.txt",
        "META-INF/NOTICE.txt",
        "com/cryptomorin/xseries/XBiome*",
        "com/cryptomorin/xseries/XEntity*",
        "com/cryptomorin/xseries/XPotion*",
        "com/cryptomorin/xseries/NMSExtras*",
        "com/cryptomorin/xseries/NoteBlockMusic*",
        "com/cryptomorin/xseries/SkullCacheListener*"
    )
    relocate("com.github.benmanes.caffeine", "me.moomoo.anarchyexploitfixes.libs.caffeine")
    relocate("io.papermc.lib", "me.moomoo.anarchyexploitfixes.libs.paperlib")
    relocate("de.tr7zw.changeme.nbtapi", "me.moomoo.anarchyexploitfixes.libs.nbtapi")
    relocate("org.bstats", "me.moomoo.anarchyexploitfixes.libs.bstats")
    relocate("com.cryptomorin.xseries", "me.moomoo.anarchyexploitfixes.libs.xseries")
}
